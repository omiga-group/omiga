# syntax = docker/dockerfile:1.4.1
FROM golang:1.19
LABEL maintainer="morteza@omiga.com.au"

RUN --mount=type=cache,target=/go go install github.com/google/wire/cmd/wire@latest
RUN --mount=type=cache,target=/go go install entgo.io/ent/cmd/ent@latest
RUN --mount=type=cache,target=/go go install github.com/deepmap/oapi-codegen/cmd/oapi-codegen@latest
RUN --mount=type=cache,target=/go go install github.com/golang/mock/mockgen@v1.6.0

RUN mkdir -p /src/shared/enterprise \
    mkdir -p /src/shared/clients \
    mkdir -p /src/order/shared \
    mkdir -p /src/order/order-processor

COPY go.mod /src/
COPY go.sum /src/
COPY shared/enterprise /src/shared/enterprise
COPY shared/clients /src/shared/clients
COPY order/shared /src/order/shared
COPY order/order-processor /src/order/order-processor

WORKDIR /src/order/order-processor

ENV GOFLAGS -mod=mod
RUN --mount=type=cache,target=/go go generate ./...
